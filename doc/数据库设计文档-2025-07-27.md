# 个人摄影师微信小程序 - 数据库设计文档

**文档版本：** v1.0  
**创建日期：** 2025-07-27
**作者：** 开发团队  

## 📋 文档概述

本文档详细描述了个人摄影师微信小程序的数据库设计，包括表结构设计、索引设计、数据字典、约束规则等，为数据库开发和维护提供技术指导。

## 🎯 设计原则

### 数据库设计原则
- **规范化设计**：遵循第三范式，避免数据冗余
- **性能优化**：合理设计索引，优化查询性能
- **扩展性**：预留扩展字段，支持业务发展
- **安全性**：敏感数据加密存储，权限控制
- **一致性**：统一命名规范，保持数据一致性

### 命名规范
- **表名**：小写字母 + 下划线，复数形式，如 `users`、`portfolios`
- **字段名**：小写字母 + 下划线，如 `user_id`、`created_at`
- **索引名**：`idx_表名_字段名`，如 `idx_users_openid`
- **外键名**：`fk_表名_字段名`，如 `fk_portfolios_photographer_id`

### 通用字段规范
所有业务表都包含以下通用字段，用于数据追踪和软删除：

- **creator** `BIGINT` - 创建人ID，记录数据创建者
- **create_time** `TIMESTAMP` - 创建时间，默认 `CURRENT_TIMESTAMP`
- **updater** `BIGINT` - 更新人ID，记录最后修改者
- **update_time** `TIMESTAMP` - 更新时间，默认 `CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP`
- **is_delete** `TINYINT` - 逻辑删除标识，0-未删除，1-已删除，默认0

**说明：**
- 通用字段支持数据审计和追踪功能
- 采用逻辑删除机制，保证数据完整性
- 创建人和更新人ID关联用户表或管理员表

## 🗄️ 数据库配置

### 基础配置
```sql
-- 数据库创建
CREATE DATABASE shoot_sunrise 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

-- 时区设置
SET time_zone = '+08:00';

-- 存储引擎：InnoDB
-- 字符集：utf8mb4
-- 排序规则：utf8mb4_unicode_ci
```

### 连接池配置
```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/shoot_sunrise?useUnicode=true&characterEncoding=utf8mb4&useSSL=false&serverTimezone=Asia/Shanghai
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:password}
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      # 初始连接数
      initial-size: 5
      # 最小连接池数量
      min-idle: 5
      # 最大连接池数量
      max-active: 20
      # 配置获取连接等待超时的时间
      max-wait: 60000
      # 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒
      time-between-eviction-runs-millis: 60000
      # 配置一个连接在池中最小生存的时间，单位是毫秒
      min-evictable-idle-time-millis: 300000
      # 配置一个连接在池中最大生存的时间，单位是毫秒
      max-evictable-idle-time-millis: 900000
      # 配置检测连接是否有效
      validation-query: SELECT 1 FROM DUAL
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      # 打开PSCache，并且指定每个连接上PSCache的大小
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      # 配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙
      filters: stat,wall,slf4j
      # 通过connectProperties属性来打开mergeSql功能；慢SQL记录
      connection-properties: druid.stat.mergeSql\=true;druid.stat.slowSqlMillis\=5000
      # 配置DruidStatFilter
      web-stat-filter:
        enabled: true
        url-pattern: "/*"
        exclusions: "*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"
      # 配置DruidStatViewServlet
      stat-view-servlet:
        enabled: true
        url-pattern: "/druid/*"
        # IP白名单(没有配置或者为空，则允许所有访问)
        allow: 127.0.0.1,192.168.163.1
        # IP黑名单 (存在共同时，deny优先于allow)
        deny: 192.168.1.73
        # 禁用HTML页面上的"Reset All"功能
        reset-enable: false
        # 登录名
        login-username: admin
        # 登录密码
        login-password: 123456
```

## 📊 核心数据表设计

### 1. 用户相关表

#### 1.1 users - 用户基础信息表
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
    openid VARCHAR(64) UNIQUE NOT NULL COMMENT '微信openid',
    unionid VARCHAR(64) COMMENT '微信unionid',
    nickname VARCHAR(50) COMMENT '昵称',
    avatar_url VARCHAR(255) COMMENT '头像URL',
    phone VARCHAR(20) COMMENT '手机号',
    gender TINYINT DEFAULT 0 COMMENT '性别：0-未知，1-男，2-女',
    city VARCHAR(50) COMMENT '城市',
    province VARCHAR(50) COMMENT '省份',
    country VARCHAR(50) COMMENT '国家',
    current_role ENUM('CLIENT', 'PHOTOGRAPHER') DEFAULT 'CLIENT' COMMENT '当前角色',
    status TINYINT DEFAULT 1 COMMENT '状态：0-禁用，1-正常',
    last_login_at TIMESTAMP NULL COMMENT '最后登录时间',
    login_count INT DEFAULT 0 COMMENT '登录次数',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    
    INDEX idx_openid (openid),
    INDEX idx_unionid (unionid),
    INDEX idx_phone (phone),
    INDEX idx_status (status),
    INDEX idx_current_role (current_role),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户基础信息表';
```

**字段说明：**
- `id`: 主键，自增长
- `openid`: 微信小程序唯一标识，必填且唯一
- `unionid`: 微信开放平台唯一标识，用于多应用用户统一
- `current_role`: 当前使用角色，支持客户和摄影师身份切换
- `status`: 用户状态，支持禁用功能
- `last_login_at`: 记录最后登录时间，用于用户活跃度分析

#### 1.2 photographer_profiles - 摄影师认证信息表
```sql
CREATE TABLE photographer_profiles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '摄影师资料ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    real_name VARCHAR(50) COMMENT '真实姓名',
    id_card VARCHAR(20) COMMENT '身份证号（加密存储）',
    bio TEXT COMMENT '个人简介',
    specialties JSON COMMENT '擅长领域 ["人像", "风景", "婚纱"]',
    experience_years INT COMMENT '从业年限',
    certification_status ENUM('PENDING', 'APPROVED', 'REJECTED') DEFAULT 'PENDING' COMMENT '认证状态',
    certification_time TIMESTAMP NULL COMMENT '认证时间',
    rejection_reason TEXT COMMENT '拒绝原因',
    service_areas JSON COMMENT '服务区域 ["北京", "上海"]',
    contact_wechat VARCHAR(50) COMMENT '微信号',
    contact_phone VARCHAR(20) COMMENT '联系电话',
    portfolio_cover VARCHAR(255) COMMENT '作品集封面',
    rating DECIMAL(3,2) DEFAULT 5.00 COMMENT '评分(1.00-5.00)',
    total_orders INT DEFAULT 0 COMMENT '总订单数',
    completed_orders INT DEFAULT 0 COMMENT '完成订单数',
    total_revenue DECIMAL(12,2) DEFAULT 0.00 COMMENT '总收入',
    is_featured BOOLEAN DEFAULT FALSE COMMENT '是否推荐摄影师',
    sort_order INT DEFAULT 0 COMMENT '排序权重',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    
    FOREIGN KEY fk_photographer_user_id (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_certification_status (certification_status),
    INDEX idx_rating (rating),
    INDEX idx_is_featured (is_featured),
    INDEX idx_sort_order (sort_order),
    FULLTEXT idx_bio (bio)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='摄影师认证信息表';
```

**字段说明：**
- `specialties`: JSON格式存储擅长领域，支持多选
- `certification_status`: 认证状态，支持审核流程
- `rating`: 评分使用DECIMAL确保精度
- `is_featured`: 推荐摄影师标识，用于首页展示
- `sort_order`: 排序权重，数值越大排序越靠前

#### 1.3 user_roles - 用户角色关联表
```sql
CREATE TABLE user_roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '角色关联ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    role_type ENUM('CLIENT', 'PHOTOGRAPHER', 'ADMIN') NOT NULL COMMENT '角色类型',
    is_active BOOLEAN DEFAULT TRUE COMMENT '是否激活',
    activated_at TIMESTAMP NULL COMMENT '激活时间',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    
    FOREIGN KEY fk_user_roles_user_id (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_role (user_id, role_type),
    INDEX idx_user_id (user_id),
    INDEX idx_role_type (role_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户角色关联表';
```

### 2. 作品管理相关表

#### 2.1 portfolios - 作品集表
```sql
CREATE TABLE portfolios (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '作品ID',
    photographer_id BIGINT NOT NULL COMMENT '摄影师ID',
    title VARCHAR(100) NOT NULL COMMENT '作品标题',
    description TEXT COMMENT '作品描述',
    category VARCHAR(50) COMMENT '作品分类',
    style VARCHAR(50) COMMENT '拍摄风格',
    location VARCHAR(100) COMMENT '拍摄地点',
    shoot_date DATE COMMENT '拍摄日期',
    camera_info JSON COMMENT '拍摄参数 {"camera":"Canon EOS R5","lens":"24-70mm"}',
    cover_image VARCHAR(255) COMMENT '封面图片URL',
    images JSON COMMENT '图片列表 ["url1","url2"]',
    videos JSON COMMENT '视频列表 [{"url":"","thumbnail":"","duration":120}]',
    likes_count INT DEFAULT 0 COMMENT '点赞数',
    views_count INT DEFAULT 0 COMMENT '浏览数',
    comments_count INT DEFAULT 0 COMMENT '评论数',
    shares_count INT DEFAULT 0 COMMENT '分享数',
    is_featured BOOLEAN DEFAULT FALSE COMMENT '是否精选',
    is_private BOOLEAN DEFAULT FALSE COMMENT '是否私有',
    status ENUM('DRAFT', 'PUBLISHED', 'HIDDEN', 'DELETED') DEFAULT 'DRAFT' COMMENT '状态',
    sort_order INT DEFAULT 0 COMMENT '排序权重',
    seo_keywords VARCHAR(200) COMMENT 'SEO关键词',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    
    FOREIGN KEY fk_portfolios_photographer_id (photographer_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_photographer_id (photographer_id),
    INDEX idx_category (category),
    INDEX idx_style (style),
    INDEX idx_status (status),
    INDEX idx_is_featured (is_featured),
    INDEX idx_likes_count (likes_count),
    INDEX idx_views_count (views_count),
    INDEX idx_created_at (created_at),
    INDEX idx_sort_order (sort_order),
    FULLTEXT idx_title_desc (title, description)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='作品集表';
```

#### 2.2 portfolio_categories - 作品分类表
```sql
CREATE TABLE portfolio_categories (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '分类ID',
    name VARCHAR(50) NOT NULL COMMENT '分类名称',
    description TEXT COMMENT '分类描述',
    icon VARCHAR(255) COMMENT '分类图标',
    sort_order INT DEFAULT 0 COMMENT '排序权重',
    is_active BOOLEAN DEFAULT TRUE COMMENT '是否启用',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    
    UNIQUE KEY uk_name (name),
    INDEX idx_sort_order (sort_order),
    INDEX idx_is_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='作品分类表';
```

#### 2.3 portfolio_tags - 作品标签表
```sql
CREATE TABLE portfolio_tags (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '标签ID',
    name VARCHAR(30) NOT NULL COMMENT '标签名称',
    color VARCHAR(7) DEFAULT '#1890ff' COMMENT '标签颜色',
    usage_count INT DEFAULT 0 COMMENT '使用次数',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    
    UNIQUE KEY uk_name (name),
    INDEX idx_usage_count (usage_count)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='作品标签表';
```

#### 2.4 portfolio_tag_relations - 作品标签关联表
```sql
CREATE TABLE portfolio_tag_relations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '关联ID',
    portfolio_id BIGINT NOT NULL COMMENT '作品ID',
    tag_id BIGINT NOT NULL COMMENT '标签ID',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    
    FOREIGN KEY fk_portfolio_tag_portfolio_id (portfolio_id) REFERENCES portfolios(id) ON DELETE CASCADE,
    FOREIGN KEY fk_portfolio_tag_tag_id (tag_id) REFERENCES portfolio_tags(id) ON DELETE CASCADE,
    UNIQUE KEY uk_portfolio_tag (portfolio_id, tag_id),
    INDEX idx_portfolio_id (portfolio_id),
    INDEX idx_tag_id (tag_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='作品标签关联表';
```

### 3. 营销推广相关表

#### 3.1 promotions - 营销活动表
```sql
CREATE TABLE promotions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '活动ID',
    photographer_id BIGINT NOT NULL COMMENT '摄影师ID',
    title VARCHAR(100) NOT NULL COMMENT '活动标题',
    description TEXT COMMENT '活动描述',
    type ENUM('DISCOUNT', 'FULL_REDUCTION', 'GIFT', 'LIMITED_TIME') NOT NULL COMMENT '活动类型',
    discount_rate DECIMAL(3,2) COMMENT '折扣率(0.01-0.99)',
    min_amount DECIMAL(10,2) COMMENT '最低消费金额',
    reduction_amount DECIMAL(10,2) COMMENT '减免金额',
    gift_description TEXT COMMENT '赠品描述',
    start_time TIMESTAMP NOT NULL COMMENT '开始时间',
    end_time TIMESTAMP NOT NULL COMMENT '结束时间',
    usage_limit INT COMMENT '使用次数限制',
    used_count INT DEFAULT 0 COMMENT '已使用次数',
    target_audience ENUM('ALL', 'NEW_USER', 'VIP_USER') DEFAULT 'ALL' COMMENT '目标用户',
    is_active BOOLEAN DEFAULT TRUE COMMENT '是否启用',
    banner_image VARCHAR(255) COMMENT '活动横幅图片',
    share_image VARCHAR(255) COMMENT '分享图片',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',
    
    FOREIGN KEY fk_promotions_photographer_id (photographer_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_photographer_id (photographer_id),
    INDEX idx_type (type),
    INDEX idx_start_end_time (start_time, end_time),
    INDEX idx_is_active (is_active),
    INDEX idx_target_audience (target_audience)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='营销活动表';
```

### 4. 系统功能相关表

#### 4.1 favorites - 收藏记录表
```sql
CREATE TABLE favorites (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '收藏ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    target_type ENUM('PHOTOGRAPHER', 'PORTFOLIO', 'PACKAGE') NOT NULL COMMENT '收藏类型',
    target_id BIGINT NOT NULL COMMENT '目标ID',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    FOREIGN KEY fk_favorites_user_id (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_target (user_id, target_type, target_id),
    INDEX idx_user_id (user_id),
    INDEX idx_target_type (target_type),
    INDEX idx_target_id (target_id),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='收藏记录表';
```

#### 4.2 notifications - 系统通知表
```sql
CREATE TABLE notifications (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '通知ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    type VARCHAR(50) NOT NULL COMMENT '通知类型',
    title VARCHAR(100) NOT NULL COMMENT '通知标题',
    content TEXT COMMENT '通知内容',
    data JSON COMMENT '附加数据',
    is_read BOOLEAN DEFAULT FALSE COMMENT '是否已读',
    read_at TIMESTAMP NULL COMMENT '阅读时间',
    priority ENUM('LOW', 'NORMAL', 'HIGH', 'URGENT') DEFAULT 'NORMAL' COMMENT '优先级',
    expire_at TIMESTAMP NULL COMMENT '过期时间',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    FOREIGN KEY fk_notifications_user_id (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_created (user_id, created_at),
    INDEX idx_type (type),
    INDEX idx_is_read (is_read),
    INDEX idx_priority (priority),
    INDEX idx_expire_at (expire_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统通知表';
```

#### 4.3 system_configs - 系统配置表
```sql
CREATE TABLE system_configs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '配置ID',
    config_key VARCHAR(100) NOT NULL COMMENT '配置键',
    config_value TEXT COMMENT '配置值',
    config_type ENUM('STRING', 'NUMBER', 'BOOLEAN', 'JSON') DEFAULT 'STRING' COMMENT '配置类型',
    description TEXT COMMENT '配置描述',
    is_public BOOLEAN DEFAULT FALSE COMMENT '是否公开配置',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    UNIQUE KEY uk_config_key (config_key),
    INDEX idx_is_public (is_public)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统配置表';
```

#### 4.4 operation_logs - 操作日志表
```sql
CREATE TABLE operation_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '日志ID',
    user_id BIGINT COMMENT '操作用户ID',
    operation_type VARCHAR(50) NOT NULL COMMENT '操作类型',
    operation_desc VARCHAR(200) COMMENT '操作描述',
    request_method VARCHAR(10) COMMENT '请求方法',
    request_url VARCHAR(500) COMMENT '请求URL',
    request_params TEXT COMMENT '请求参数',
    response_data TEXT COMMENT '响应数据',
    ip_address VARCHAR(50) COMMENT 'IP地址',
    user_agent TEXT COMMENT '用户代理',
    execution_time INT COMMENT '执行时间(毫秒)',
    status ENUM('SUCCESS', 'FAILED', 'ERROR') DEFAULT 'SUCCESS' COMMENT '执行状态',
    error_message TEXT COMMENT '错误信息',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    INDEX idx_user_id (user_id),
    INDEX idx_operation_type (operation_type),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at),
    INDEX idx_ip_address (ip_address)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='操作日志表';
```

### 5. 文件存储相关表

#### 5.1 file_uploads - 文件上传记录表
```sql
CREATE TABLE file_uploads (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '文件ID',
    user_id BIGINT NOT NULL COMMENT '上传用户ID',
    original_name VARCHAR(255) NOT NULL COMMENT '原始文件名',
    file_name VARCHAR(255) NOT NULL COMMENT '存储文件名',
    file_path VARCHAR(500) NOT NULL COMMENT '文件路径',
    file_url VARCHAR(500) COMMENT '访问URL',
    file_size BIGINT NOT NULL COMMENT '文件大小(字节)',
    file_type VARCHAR(50) COMMENT '文件类型',
    mime_type VARCHAR(100) COMMENT 'MIME类型',
    storage_type ENUM('LOCAL', 'OSS', 'CDN') DEFAULT 'LOCAL' COMMENT '存储类型',
    business_type VARCHAR(50) COMMENT '业务类型',
    business_id BIGINT COMMENT '业务ID',
    is_temp BOOLEAN DEFAULT FALSE COMMENT '是否临时文件',
    expire_at TIMESTAMP NULL COMMENT '过期时间',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    FOREIGN KEY fk_file_uploads_user_id (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_file_type (file_type),
    INDEX idx_storage_type (storage_type),
    INDEX idx_business (business_type, business_id),
    INDEX idx_is_temp (is_temp),
    INDEX idx_expire_at (expire_at),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='文件上传记录表';
```

### 6. 业务核心表

#### 6.1 service_packages - 服务套餐表
```sql
CREATE TABLE service_packages (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '套餐ID',
    photographer_id BIGINT NOT NULL COMMENT '摄影师ID',
    name VARCHAR(100) NOT NULL COMMENT '套餐名称',
    description TEXT COMMENT '套餐描述',
    category ENUM('WEDDING', 'PORTRAIT', 'COMMERCIAL', 'EVENT', 'OTHER') NOT NULL COMMENT '套餐类型',
    price DECIMAL(10,2) NOT NULL COMMENT '套餐价格',
    duration INT COMMENT '拍摄时长(分钟)',
    photo_count INT COMMENT '照片数量',
    includes JSON COMMENT '包含服务 ["化妆", "精修"]',
    excludes JSON COMMENT '不包含服务',
    is_active BOOLEAN DEFAULT TRUE COMMENT '是否启用',
    sort_order INT DEFAULT 0 COMMENT '排序权重',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    FOREIGN KEY fk_packages_photographer_id (photographer_id) REFERENCES photographer_profiles(user_id) ON DELETE CASCADE,
    INDEX idx_photographer_id (photographer_id),
    INDEX idx_category (category),
    INDEX idx_price (price),
    INDEX idx_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='服务套餐表';
```

#### 6.2 bookings - 预约表
```sql
CREATE TABLE bookings (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '预约ID',
    booking_no VARCHAR(32) UNIQUE NOT NULL COMMENT '预约编号',
    client_id BIGINT NOT NULL COMMENT '客户ID',
    photographer_id BIGINT NOT NULL COMMENT '摄影师ID',
    package_id BIGINT COMMENT '套餐ID',
    status ENUM('PENDING', 'CONFIRMED', 'REJECTED', 'CANCELLED', 'COMPLETED') DEFAULT 'PENDING' COMMENT '预约状态',
    shoot_date DATE NOT NULL COMMENT '拍摄日期',
    shoot_time TIME NOT NULL COMMENT '拍摄时间',
    location VARCHAR(255) NOT NULL COMMENT '拍摄地点',
    theme VARCHAR(100) COMMENT '拍摄主题',
    requirements TEXT COMMENT '特殊要求',
    contact_name VARCHAR(50) NOT NULL COMMENT '联系人姓名',
    contact_phone VARCHAR(20) NOT NULL COMMENT '联系电话',
    total_amount DECIMAL(10,2) COMMENT '总金额',
    deposit_amount DECIMAL(10,2) COMMENT '定金金额',
    final_amount DECIMAL(10,2) COMMENT '尾款金额',
    confirmed_at TIMESTAMP NULL COMMENT '确认时间',
    cancelled_at TIMESTAMP NULL COMMENT '取消时间',
    cancel_reason VARCHAR(255) COMMENT '取消原因',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    FOREIGN KEY fk_bookings_client_id (client_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_bookings_photographer_id (photographer_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_bookings_package_id (package_id) REFERENCES service_packages(id) ON DELETE SET NULL,
    INDEX idx_booking_no (booking_no),
    INDEX idx_client_id (client_id),
    INDEX idx_photographer_id (photographer_id),
    INDEX idx_package_id (package_id),
    INDEX idx_status (status),
    INDEX idx_shoot_date (shoot_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='预约表';
```

#### 6.3 orders - 订单表
```sql
CREATE TABLE orders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '订单ID',
    order_no VARCHAR(32) UNIQUE NOT NULL COMMENT '订单编号',
    booking_id BIGINT NOT NULL COMMENT '预约ID',
    client_id BIGINT NOT NULL COMMENT '客户ID',
    photographer_id BIGINT NOT NULL COMMENT '摄影师ID',
    status ENUM('PENDING', 'PAID', 'PARTIAL_PAID', 'REFUNDED', 'CANCELLED') DEFAULT 'PENDING' COMMENT '订单状态',
    total_amount DECIMAL(10,2) NOT NULL COMMENT '订单总金额',
    paid_amount DECIMAL(10,2) DEFAULT 0.00 COMMENT '已支付金额',
    refund_amount DECIMAL(10,2) DEFAULT 0.00 COMMENT '退款金额',
    payment_method ENUM('WECHAT', 'ALIPAY', 'BANK_TRANSFER') COMMENT '支付方式',
    payment_time TIMESTAMP NULL COMMENT '支付时间',
    invoice_requested BOOLEAN DEFAULT FALSE COMMENT '是否需要发票',
    invoice_title VARCHAR(100) COMMENT '发票抬头',
    invoice_tax_no VARCHAR(50) COMMENT '税号',
    notes TEXT COMMENT '订单备注',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    FOREIGN KEY fk_orders_booking_id (booking_id) REFERENCES bookings(id) ON DELETE CASCADE,
    FOREIGN KEY fk_orders_client_id (client_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_orders_photographer_id (photographer_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_order_no (order_no),
    INDEX idx_booking_id (booking_id),
    INDEX idx_client_id (client_id),
    INDEX idx_photographer_id (photographer_id),
    INDEX idx_status (status),
    INDEX idx_payment_time (payment_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='订单表';
```

#### 6.4 reviews - 评价表
```sql
CREATE TABLE reviews (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '评价ID',
    order_id BIGINT NOT NULL COMMENT '订单ID',
    client_id BIGINT NOT NULL COMMENT '客户ID',
    photographer_id BIGINT NOT NULL COMMENT '摄影师ID',
    rating TINYINT NOT NULL COMMENT '评分(1-5)',
    service_rating TINYINT COMMENT '服务态度评分',
    skill_rating TINYINT COMMENT '拍摄技术评分',
    quality_rating TINYINT COMMENT '作品质量评分',
    content TEXT COMMENT '评价内容',
    photos JSON COMMENT '评价照片',
    is_anonymous BOOLEAN DEFAULT FALSE COMMENT '是否匿名评价',
    reply_content TEXT COMMENT '摄影师回复',
    reply_time TIMESTAMP NULL COMMENT '回复时间',
    is_featured BOOLEAN DEFAULT FALSE COMMENT '是否精选评价',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '评价时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    FOREIGN KEY fk_reviews_order_id (order_id) REFERENCES orders(id) ON DELETE CASCADE,
    FOREIGN KEY fk_reviews_client_id (client_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_reviews_photographer_id (photographer_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_order_id (order_id),
    INDEX idx_client_id (client_id),
    INDEX idx_photographer_id (photographer_id),
    INDEX idx_rating (rating),
    INDEX idx_featured (is_featured)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='评价表';
```

#### 6.5 user_favorites - 收藏表
```sql
CREATE TABLE user_favorites (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '收藏ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    target_type ENUM('PHOTOGRAPHER', 'PORTFOLIO', 'PACKAGE') NOT NULL COMMENT '收藏类型',
    target_id BIGINT NOT NULL COMMENT '目标ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '收藏时间',

    FOREIGN KEY fk_favorites_user_id (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_target (user_id, target_type, target_id),
    INDEX idx_user_id (user_id),
    INDEX idx_target (target_type, target_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户收藏表';
```

## 📈 数据字典

### 枚举值说明

#### 用户相关枚举
```sql
-- 性别枚举
-- 0: 未知, 1: 男, 2: 女

-- 用户角色枚举
-- CLIENT: 客户, PHOTOGRAPHER: 摄影师, ADMIN: 管理员

-- 用户状态枚举
-- 0: 禁用, 1: 正常

-- 认证状态枚举
-- PENDING: 待审核, APPROVED: 已通过, REJECTED: 已拒绝
```

#### 作品相关枚举
```sql
-- 作品状态枚举
-- DRAFT: 草稿, PUBLISHED: 已发布, HIDDEN: 已隐藏, DELETED: 已删除

-- 作品分类示例
-- 人像摄影, 风景摄影, 婚纱摄影, 儿童摄影, 商业摄影, 产品摄影
```

#### 营销活动枚举
```sql
-- 活动类型枚举
-- DISCOUNT: 折扣, FULL_REDUCTION: 满减, GIFT: 赠品, LIMITED_TIME: 限时优惠

-- 目标用户枚举
-- ALL: 所有用户, NEW_USER: 新用户, VIP_USER: VIP用户
```

#### 系统功能枚举
```sql
-- 收藏类型枚举
-- PHOTOGRAPHER: 摄影师, PORTFOLIO: 作品, PACKAGE: 套餐

-- 通知优先级枚举
-- LOW: 低, NORMAL: 普通, HIGH: 高, URGENT: 紧急

-- 配置类型枚举
-- STRING: 字符串, NUMBER: 数字, BOOLEAN: 布尔值, JSON: JSON对象

-- 存储类型枚举
-- LOCAL: 本地存储, OSS: 对象存储, CDN: CDN存储
```

## 🔍 索引设计策略

### 主要索引说明

#### 1. 唯一索引
- `users.openid`: 微信用户唯一标识
- `portfolio_categories.name`: 分类名称唯一
- `portfolio_tags.name`: 标签名称唯一
- `system_configs.config_key`: 配置键唯一

#### 2. 复合索引
- `user_roles(user_id, role_type)`: 用户角色查询
- `portfolio_tag_relations(portfolio_id, tag_id)`: 作品标签关联
- `favorites(user_id, target_type, target_id)`: 收藏查询
- `notifications(user_id, created_at)`: 用户通知查询

#### 3. 全文索引
- `photographer_profiles.bio`: 摄影师简介搜索
- `portfolios(title, description)`: 作品标题和描述搜索

### 索引优化建议

#### 查询优化
```sql
-- 1. 摄影师列表查询优化
-- 使用复合索引: (certification_status, rating, is_featured)
SELECT * FROM photographer_profiles
WHERE certification_status = 'APPROVED'
  AND rating >= 4.0
ORDER BY is_featured DESC, rating DESC;

-- 2. 作品列表查询优化
-- 使用复合索引: (photographer_id, status, created_at)
SELECT * FROM portfolios
WHERE photographer_id = ?
  AND status = 'PUBLISHED'
ORDER BY created_at DESC;

-- 3. 用户收藏查询优化
-- 使用复合索引: (user_id, target_type, created_at)
SELECT * FROM favorites
WHERE user_id = ?
  AND target_type = 'PORTFOLIO'
ORDER BY created_at DESC;
```

## 🔒 数据安全设计

### 敏感数据处理

#### 1. 数据加密
```sql
-- 身份证号加密存储
-- 使用AES-256加密算法
-- 加密密钥通过环境变量配置

-- 手机号脱敏显示
-- 显示格式: 138****8888
-- 存储完整号码，查询时脱敏
```

#### 2. 数据备份策略
```sql
-- 全量备份: 每日凌晨2点
-- 增量备份: 每4小时一次
-- 备份保留: 30天
-- 异地备份: 重要数据异地存储
```

### 数据完整性约束

#### 1. 外键约束
- 所有关联表设置外键约束
- 级联删除策略: CASCADE
- 防止孤立数据产生

#### 2. 检查约束
```sql
-- 评分范围约束
ALTER TABLE photographer_profiles
ADD CONSTRAINT chk_rating
CHECK (rating >= 1.00 AND rating <= 5.00);

-- 折扣率范围约束
ALTER TABLE promotions
ADD CONSTRAINT chk_discount_rate
CHECK (discount_rate >= 0.01 AND discount_rate <= 0.99);
```

## 📊 数据库设计分析与模块表分配

### 设计满足度评估

#### ✅ 优点分析
1. **表结构完整**：覆盖了用户、作品、营销、系统管理等核心业务
2. **字段设计合理**：使用了适当的数据类型和约束
3. **索引设计良好**：为查询性能做了优化
4. **扩展性考虑**：使用JSON字段支持灵活数据存储

#### ⚠️ 需要补充的表
经过分析，现有设计基本满足系统需求，但需要补充以下表：

##### 1. 用户互动相关表
```sql
-- 用户点赞记录表
CREATE TABLE user_likes (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '点赞ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    target_type ENUM('PORTFOLIO', 'PHOTOGRAPHER') NOT NULL COMMENT '点赞类型',
    target_id BIGINT NOT NULL COMMENT '目标ID',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    UNIQUE KEY uk_user_target (user_id, target_type, target_id),
    INDEX idx_user_id (user_id),
    INDEX idx_target (target_type, target_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户点赞记录表';

-- 用户关注关系表
CREATE TABLE user_follows (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '关注ID',
    follower_id BIGINT NOT NULL COMMENT '关注者ID',
    following_id BIGINT NOT NULL COMMENT '被关注者ID',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '关注时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    UNIQUE KEY uk_follower_following (follower_id, following_id),
    INDEX idx_follower_id (follower_id),
    INDEX idx_following_id (following_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户关注关系表';
```

##### 2. 审核管理相关表
```sql
-- 内容审核日志表
CREATE TABLE audit_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '审核日志ID',
    audit_type ENUM('PORTFOLIO', 'PHOTOGRAPHER', 'PROMOTION') NOT NULL COMMENT '审核类型',
    target_id BIGINT NOT NULL COMMENT '目标ID',
    target_type VARCHAR(50) NOT NULL COMMENT '目标类型',
    audit_status ENUM('PENDING', 'APPROVED', 'REJECTED') NOT NULL COMMENT '审核状态',
    auditor_id BIGINT COMMENT '审核员ID',
    auditor_name VARCHAR(50) COMMENT '审核员姓名',
    audit_reason VARCHAR(500) COMMENT '审核意见',
    audit_comment TEXT COMMENT '审核备注',
    audit_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '审核时间',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    INDEX idx_audit_type (audit_type),
    INDEX idx_target (target_type, target_id),
    INDEX idx_audit_status (audit_status),
    INDEX idx_auditor_id (auditor_id),
    INDEX idx_audit_time (audit_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='内容审核日志表';
```

##### 3. 营销活动扩展表
```sql
-- 营销活动参与记录表
CREATE TABLE promotion_participants (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '参与记录ID',
    promotion_id BIGINT NOT NULL COMMENT '活动ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    coupon_code VARCHAR(50) COMMENT '优惠券码',
    used_at TIMESTAMP NULL COMMENT '使用时间',
    order_id BIGINT COMMENT '关联订单ID',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '参与时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    UNIQUE KEY uk_promotion_user (promotion_id, user_id),
    INDEX idx_promotion_id (promotion_id),
    INDEX idx_user_id (user_id),
    INDEX idx_coupon_code (coupon_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='营销活动参与记录表';

-- 营销活动统计表
CREATE TABLE promotion_statistics (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '统计ID',
    promotion_id BIGINT NOT NULL COMMENT '活动ID',
    stat_date DATE NOT NULL COMMENT '统计日期',
    view_count INT DEFAULT 0 COMMENT '浏览次数',
    share_count INT DEFAULT 0 COMMENT '分享次数',
    participant_count INT DEFAULT 0 COMMENT '参与人数',
    conversion_count INT DEFAULT 0 COMMENT '转化次数',
    revenue_amount DECIMAL(10,2) DEFAULT 0.00 COMMENT '产生收入',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    UNIQUE KEY uk_promotion_date (promotion_id, stat_date),
    INDEX idx_promotion_id (promotion_id),
    INDEX idx_stat_date (stat_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='营销活动统计表';
```

##### 4. 管理后台相关表
```sql
-- 管理员用户表
CREATE TABLE admin_users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '管理员ID',
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码(加密)',
    nickname VARCHAR(50) COMMENT '昵称',
    avatar VARCHAR(255) COMMENT '头像',
    email VARCHAR(100) COMMENT '邮箱',
    phone VARCHAR(20) COMMENT '手机号',
    role ENUM('SUPER_ADMIN', 'ADMIN', 'AUDITOR') DEFAULT 'ADMIN' COMMENT '角色',
    permissions JSON COMMENT '权限列表',
    status TINYINT DEFAULT 1 COMMENT '状态：0-禁用，1-正常',
    last_login_at TIMESTAMP NULL COMMENT '最后登录时间',
    last_login_ip VARCHAR(50) COMMENT '最后登录IP',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    INDEX idx_username (username),
    INDEX idx_role (role),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='管理员用户表';

-- 系统统计数据表
CREATE TABLE system_statistics (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '统计ID',
    stat_date DATE NOT NULL COMMENT '统计日期',
    stat_type ENUM('DAILY', 'WEEKLY', 'MONTHLY') NOT NULL COMMENT '统计类型',
    user_count INT DEFAULT 0 COMMENT '用户总数',
    new_user_count INT DEFAULT 0 COMMENT '新增用户数',
    active_user_count INT DEFAULT 0 COMMENT '活跃用户数',
    photographer_count INT DEFAULT 0 COMMENT '摄影师总数',
    portfolio_count INT DEFAULT 0 COMMENT '作品总数',
    new_portfolio_count INT DEFAULT 0 COMMENT '新增作品数',
    promotion_count INT DEFAULT 0 COMMENT '活动总数',
    revenue_amount DECIMAL(12,2) DEFAULT 0.00 COMMENT '总收入',
    creator BIGINT COMMENT '创建人ID',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updater BIGINT COMMENT '更新人ID',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_delete TINYINT DEFAULT 0 COMMENT '是否删除：0-未删除，1-已删除',

    UNIQUE KEY uk_date_type (stat_date, stat_type),
    INDEX idx_stat_date (stat_date),
    INDEX idx_stat_type (stat_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统统计数据表';
```

### 🗄️ 模块表分配

#### 1. 用户认证与权限管理模块

**核心表：**
- `users` - 用户基础信息表
- `photographer_profiles` - 摄影师认证信息表
- `user_roles` - 用户角色关联表

**业务外键关系：**
```
photographer_profiles.user_id -> users.id (一对一关系)
user_roles.user_id -> users.id (一对多关系)
```

**支持功能：**
- 微信登录认证
- 角色切换（客户/摄影师）
- 摄影师认证申请与审核
- 用户权限控制

#### 2. 作品展示与管理模块

**核心表：**
- `portfolios` - 作品集表
- `portfolio_categories` - 作品分类表
- `portfolio_tags` - 作品标签表
- `portfolio_tag_relations` - 作品标签关联表
- `file_uploads` - 文件上传记录表
- `user_likes` - 用户点赞记录表（新增）
- `audit_logs` - 内容审核日志表（新增）

**业务外键关系：**
```
portfolios.photographer_id -> users.id (多对一关系)
portfolios.category -> portfolio_categories.name (多对一关系，建议改为ID关联)
portfolio_tag_relations.portfolio_id -> portfolios.id (多对一关系)
portfolio_tag_relations.tag_id -> portfolio_tags.id (多对一关系)
file_uploads.business_id -> portfolios.id (当business_type='PORTFOLIO')
user_likes.user_id -> users.id (多对一关系)
user_likes.target_id -> portfolios.id 或 users.id (根据target_type)
audit_logs.target_id -> portfolios.id (当audit_type='PORTFOLIO')
audit_logs.auditor_id -> admin_users.id (多对一关系)
```

**支持功能：**
- 作品发布与管理
- 作品分类与标签
- 作品搜索与筛选
- 作品点赞与收藏
- 图片上传与处理
- 作品审核流程

#### 3. 营销推广模块

**核心表：**
- `promotions` - 营销活动表
- `promotion_participants` - 营销活动参与记录表（新增）
- `promotion_statistics` - 营销活动统计表（新增）

**业务外键关系：**
```
promotions.photographer_id -> users.id (多对一关系)
promotion_participants.promotion_id -> promotions.id (多对一关系)
promotion_participants.user_id -> users.id (多对一关系)
promotion_participants.order_id -> bookings.id (多对一关系)
promotion_statistics.promotion_id -> promotions.id (一对多关系)
```

**支持功能：**
- 营销活动创建与管理
- 活动参与记录
- 推广海报生成
- 活动效果统计
- 数据分析报表

#### 4. 后台管理系统模块

**核心表：**
- `admin_users` - 管理员用户表（新增）
- `system_configs` - 系统配置表
- `operation_logs` - 操作日志表
- `notifications` - 系统通知表
- `audit_logs` - 内容审核日志表（新增）
- `system_statistics` - 系统统计数据表（新增）

**业务外键关系：**
```
operation_logs.user_id -> users.id 或 admin_users.id (根据操作者类型)
notifications.user_id -> users.id (多对一关系)
audit_logs.auditor_id -> admin_users.id (多对一关系)
audit_logs.target_id -> portfolios.id/users.id/promotions.id (根据audit_type)
```

**支持功能：**
- 管理员认证与权限
- 用户管理与审核
- 内容审核与管理
- 系统配置管理
- 操作日志记录
- 数据统计分析

#### 5. 用户互动模块

**核心表：**
- `favorites` - 收藏记录表
- `user_likes` - 用户点赞记录表（新增）
- `user_follows` - 用户关注关系表（新增）

**业务外键关系：**
```
favorites.user_id -> users.id (多对一关系)
favorites.target_id -> portfolios.id/users.id/service_packages.id (根据target_type)
user_likes.user_id -> users.id (多对一关系)
user_likes.target_id -> portfolios.id/users.id (根据target_type)
user_follows.follower_id -> users.id (多对一关系)
user_follows.following_id -> users.id (多对一关系)
```

**支持功能：**
- 作品收藏管理
- 作品点赞功能
- 摄影师关注功能
- 用户互动统计

#### 6. 预约订单模块（第二期开发）

**核心表：**
- `service_packages` - 服务套餐表
- `bookings` - 预约表
- `payments` - 支付记录表
- `reviews` - 评价表

**业务外键关系：**
```
service_packages.photographer_id -> photographer_profiles.user_id (多对一关系)
bookings.client_id -> users.id (多对一关系)
bookings.photographer_id -> users.id (多对一关系)
bookings.package_id -> service_packages.id (多对一关系)
payments.booking_id -> bookings.id (一对多关系)
reviews.booking_id -> bookings.id (一对一关系)
reviews.client_id -> users.id (多对一关系)
reviews.photographer_id -> users.id (多对一关系)
```

**文档状态：** ✅ 已完成（包含模块表分配和业务外键关系）
**下一步：** 根据分析结果创建数据库表结构
**联系人：** 开发团队
